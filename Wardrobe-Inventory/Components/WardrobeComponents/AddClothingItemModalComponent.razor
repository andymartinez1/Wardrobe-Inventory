<Modal @ref="addModal" Title="Add Clothing Item">
    <BodyTemplate>
        <EditForm Model="ClothingItem" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator></DataAnnotationsValidator>

            <div class="form-group">
                <label class="form-label">Name</label>
                <InputText @bind-Value="ClothingItem.Name" class="form-control"></InputText>
                <ValidationMessage For="() => ClothingItem.Name"></ValidationMessage>
            </div>
            <div class="form-group">
                <label class="form-label">Category</label>
                <InputSelect @bind-Value="ClothingItem.Category" class="form-control">
                    @foreach (var category in Enum.GetValues(typeof(ClothingCategory)))
                    {
                        <option value="@category">@category</option>
                    }
                </InputSelect>
            </div>
            <div class="form-group">
                <label class="form-label">Brand</label>
                <InputText @bind-Value="ClothingItem.Brand" class="form-control"></InputText>
                <ValidationMessage For="() => ClothingItem.Brand"></ValidationMessage>
            </div>
            @if (ClothingItem.Category == Models.ClothingCategory.Sneakers || ClothingItem.Category == Models.ClothingCategory.Boots)
            {
                <label for="sizeFormInput">Shoe Size</label>
                <InputNumber @bind-Value="ClothingItem.ShoeSize" class="form-control"></InputNumber>
            }
            else if (ClothingItem.Category == Models.ClothingCategory.Jeans)
            {
                <label for="sizeFormInput">Jean Waist Size</label>
                <InputNumber @bind-Value="ClothingItem.JeansWaist" class="form-control"></InputNumber>
                <label for="sizeFormInput">Jean Seam Size</label>
                <InputNumber @bind-Value="ClothingItem.JeansInseam" class="form-control"></InputNumber>
            }
            else
            {
                <label for="sizeFormInput">Size</label>
                <InputSelect @bind-Value="ClothingItem.ShirtSize" class="form-control">
                    @foreach (var size in Enum.GetValues(typeof(ShirtSize)))
                    {
                        <option value="@size">@size</option>
                    }
                </InputSelect>
            }
            <div class="form-group">
                <label class="form-label">Color</label>
                <InputText @bind-Value="ClothingItem.Color" class="form-control"></InputText>
                <ValidationMessage For="() => ClothingItem.Color"></ValidationMessage>
            </div>
            <div class="form-group">
                <label class="form-label">Add Image</label>
                <InputFile accept=".png, .jpg, .jpeg" OnChange="@HandleFileSelection"></InputFile>
            </div>
            <Button Color="ButtonColor.Secondary" @onclick="OnHideModalClick">Close</Button>
            <button type="submit" class="btn btn-success">Add</Button>
        </EditForm>
    </BodyTemplate>
</Modal>

<Button class="btn btn-outline-secondary" @onclick="OnShowModalClick"><i class="bi bi-plus-square"></i></Button>

@code{
    private Modal addModal = default!;
    private IBrowserFile imagePath;

    public ClothingItem ClothingItem { get; set; } = new();
    [Parameter] public List<string> ClothingCategory { get; set; }
    [Parameter] public EventCallback<ClothingItem> Add { get; set; }

    private async Task OnShowModalClick()
    {
        await addModal.ShowAsync();
    }

    private async Task OnHideModalClick()
    {
        await addModal.HideAsync();
    }

    private async Task HandleFileSelection(InputFileChangeEventArgs e)
    {
        imagePath = e.File;
        if (imagePath != null)
        {
            // Read the file into a memory stream
            var buffer = new byte[imagePath.Size];
            await imagePath.OpenReadStream().ReadAsync(buffer);

            // Convert to Base64 string for immediate display
            ClothingItem.ImagePath = $"data:{imagePath.ContentType};base64,{Convert.ToBase64String(buffer)}";
        }
    }

    private async Task HandleValidSubmit(EditContext arg)
    {
        // Pass the new model to the parent (WardrobeInventoryList.razor)
        await Add.InvokeAsync(ClothingItem);

        await OnHideModalClick();
    }

}